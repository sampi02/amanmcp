# v0.1.23 - EmbeddingGemma Default + Ollama Removal

**Date:** 2025-12-31
**Type:** Architecture Pivot

---

## Overview

Complete removal of Ollama embedding provider and pivot to EmbeddingGemma as default model.

---

## Breaking Changes

- **Removed `--embedder=ollama` flag** - Ollama is no longer supported
- **Default model changed** - EmbeddingGemma (768 dims, 2048 ctx) replaces MiniLM (384 dims, 512 ctx)
- **Default dimensions changed** - 768 (EmbeddingGemma) instead of 384 (MiniLM)

---

## New Features

- **EmbeddingGemma Default** - Better code search with 4x larger context window
- **Simplified Architecture** - Only 2 embedding providers: Hugot and Static

---

## Changes

### Code Removed (~1,150 lines)

| File | Lines | Change |
|------|-------|--------|
| `internal/embed/ollama.go` | 375 | Deleted |
| `internal/embed/ollama_test.go` | ~250 | Deleted |
| `internal/setup/ollama.go` | ~427 | Deleted |
| `internal/setup/ollama_test.go` | ~80 | Deleted |

### Code Modified

| File | Change |
|------|--------|
| `internal/config/config.go` | Default model: embeddinggemma, dimensions: 768 |
| `internal/embed/types.go` | Removed Ollama types, added normalizeVector |
| `internal/embed/factory.go` | Removed ProviderOllama, updated ValidProviders |
| `internal/embed/hugot.go` | Updated default constants for EmbeddingGemma |
| `cmd/amanmcp/cmd/root.go` | Removed Ollama check |
| `cmd/amanmcp/cmd/setup.go` | Repurposed for Hugot model management |
| `cmd/amanmcp/cmd/doctor.go` | Removed Ollama check references |
| `cmd/amanmcp/cmd/status.go` | Removed Ollama status check |
| `internal/preflight/check.go` | Removed CheckOllama function |

### Documentation

| File | Change |
|------|--------|
| `docs/decisions/ADR-016-ollama-removal-embeddinggemma-default.md` | Created |
| `docs/decisions/index.md` | Added ADR-016, updated ADR-005 status |
| `README.md` | Updated embedding info, removed Ollama section |

---

## Migration Guide

### For Users Previously Using Ollama

```bash
# Old (no longer works)
amanmcp index . --embedder=ollama

# New equivalent (uses better EmbeddingGemma by default)
amanmcp index .

# For smaller footprint, use MiniLM
amanmcp setup --model=minilm
amanmcp index .
```

---

## Validation

- [x] `make ci-check` passes
- [x] `make test` passes (77.2% coverage)
- [x] `make lint` passes
- [x] No Ollama references in code (`grep -r "ollama" internal/ cmd/`)

---

## ADR Reference

See [ADR-016: Ollama Removal + EmbeddingGemma Default](../../decisions/ADR-016-ollama-removal-embeddinggemma-default.md)
