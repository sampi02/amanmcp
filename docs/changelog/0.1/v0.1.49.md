# v0.1.49 - Query Pattern Telemetry

**Released:** 2026-01-06

Phase 1 of the strategic roadmap is now complete. This release adds query pattern telemetry (AI-6) for data-driven search optimization.

---

## Added

- Add roadmap execution framework for multi-session strategic improvement implementation
  - `scripts/roadmap-exec.sh`: CLI state manager for tracking item progress
  - `docs/roadmap/execution-state.json`: Execution state SSOT with 26 items across 6 phases
  - Integrated with dogfood baseline validation
- Add query embedding cache (QW-1): LRU cache for query embeddings saves 50-200ms on repeated queries
  - `internal/embed/cached.go`: CachedEmbedder wrapper with 1000-entry LRU cache
  - Automatic integration via factory pattern - all embedders now cached by default
  - Disable with `AMANMCP_EMBED_CACHE=false` environment variable
- Add dimension mismatch detection and graceful degradation (QW-5)
  - Stores embedding dimension and model info during indexing
  - Validates dimensions at search time to detect embedder changes
  - Gracefully falls back to BM25-only search when dimensions mismatch
  - Clear error message: "Run 'amanmcp reindex --force' to rebuild with current embedder"
- Add context-rich search result metadata (UX-1)
  - `match_reason`: Human-readable explanation of WHY result matched
  - `symbol`, `symbol_type`, `signature`: Primary symbol info from code chunks
  - `matched_terms`: BM25 query terms that matched the result
  - `in_both_lists`: Boolean indicating result appeared in both keyword and semantic search
- Add query pattern telemetry for search optimization (AI-6)
  - `internal/telemetry/`: New package for local-only query metrics collection
  - Track query type distribution (lexical/semantic/mixed)
  - Track top 100 query terms for synonym dictionary input
  - Track zero-result queries (last 100) for expansion opportunities
  - Track latency histogram (5 buckets: <10ms, 10-50ms, 50-100ms, 100-500ms, >500ms)
  - SQLite persistence with daily aggregation (schema migration v3)
  - MCP resource `query_metrics` for AI client access
  - CLI command `amanmcp stats queries [--json] [--days N]`
  - Privacy-first: All data stays local, no external telemetry

## Changed

- Enhance CLAUDE.md template with mandatory amanmcp tool selection guidance and query tips
- Increase classifier cache size from 1000 to 10000 entries (QW-2): Better cache hit rate with minimal memory overhead (~100KB)
- Enhance MCP tool descriptions (QW-3): Explain WHY amanmcp > grep - semantic understanding, full-codebase index, 95% of search tasks
- Split embedding timeout into warm/cold (QW-4): 15s for warm queries, 20s for cold (model loading). Fail-fast on Ollama issues

## Fixed

(No bug fixes in this release)

## Removed

(No removals in this release)

## Documentation

- **Versioning audit**: Remove false v1.0 readiness claims, add explicit release checklist
  - Update docs/context.md: Change status from "Ready for v1.0" to "Pre-1.0 Stabilization"
  - Add docs/v1-release-checklist.md: Explicit gates that MUST pass before v1.0 release
  - Clarify old changelogs (v0.1.30-v0.1.34): Add notes that v1.0 was deferred for validation
  - Prevention: No v1.0 release without manually verified checklist completion
- Add `amanmcp-logs` and debugging tools documentation to README, first-time-user-guide, and error-codes guide
- Document `--debug` flag, log viewer options, and performance monitoring with `htop`/`asitop`
- Add RCA-010: Semantic search vocabulary mismatch analysis and resolution
- Add strategic improvement roadmap for 2026 with 16 prioritized improvements (docs/roadmap/strategic-improvements-2026.md)
- Update roadmap v1.1: Add QW-5 (Dimension Mismatch), Future-1 (Agentic RAG), Documentation Update Plan, ADR/Spec Creation Plan
- Update roadmap v1.2: QI-2 model selection research - recommend qwen2.5:1.5b-instruct over llama3.2:1b for ecosystem consistency
- Update roadmap v1.3: Major grounded research update - qwen3-0.6b model, DE-1 (Document Expansion), SC-1 (Semantic Result Cache), expanded Agentic RAG with arXiv references, jina-colbert-v2, 13 new research citations
- Update roadmap v1.4: Add continuous/adaptive indexing - AI-4 (Checkpoint/Resume), AI-5 (Batched Incremental), AI-6 (Query Telemetry), AI-7 (Adaptive Query Embedding)
- Update roadmap v1.5: Strategic priority review - Add CR-1 (Contextual Retrieval, 67% error reduction), upgrade AI-6/UX-1 to P1 Phase 1, downgrade AI-1/QI-2 to P2, restructure phases to prioritize document-side intelligence
- Update roadmap v1.6: Multi-project support & QA - Add Part 10 (MP-1 through MP-4 for multi-project resource management), Part 11 (Documentation checklist, benchmarking, A/B testing, rollback strategies), update Phase 4 to include multi-project items
- Update roadmap v1.7: Integrated dogfooding - Add Part 12 (system-level TDD approach), link phases to dogfood baseline measurements, add RCA-010 queries as success criteria, update plan solidity 7.5/10 â†’ 9.0/10
- Update dogfood.md v1.2: Add 3 RCA-010 vocabulary mismatch queries to Tier 1 (15 total), add roadmap integration section, link to strategic roadmap Part 12
- Add ADR-032: Query Pattern Telemetry design decisions
- Add F32: Query Telemetry feature specification

---

## Roadmap Status

**Phase 1 Complete (7/7 items):**
- QW-1: Query embedding cache
- QW-2: Classifier cache size increase
- QW-3: MCP tool descriptions
- QW-4: Split embedding timeout
- QW-5: Dimension mismatch detection
- UX-1: Context-rich result metadata
- AI-6: Query pattern telemetry

**Next:** Phase 2 - Document Intelligence (CR-1 Contextual Retrieval, DE-1 Document Expansion)

---

## Upgrade Notes

This release adds new SQLite tables for telemetry (schema migration v3). The migration runs automatically on first use. No manual intervention required.

New CLI command available:
```bash
amanmcp stats queries          # View query statistics
amanmcp stats queries --json   # JSON output for tooling
amanmcp stats queries --days 30 # Specify time range
```
